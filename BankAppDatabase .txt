/*CREATING TABLES*/
CREATE TABLE BANKUSER
(
    USERID NUMBER NOT NULL,
    FIRSTNAME VARCHAR2(200) NOT NULL,
    LASTNAME VARCHAR2(200) NOT NULL,
    USERNAME VARCHAR2(20) NOT NULL UNIQUE, 
    PASSIN VARCHAR2(20) NOT NULL, 
    ACCOUNTID NUMBER NOT NULL,
    TRANSID NUMBER NOT NULL,
    CONSTRAINT PK_USERID PRIMARY KEY (USERID)
);
    
CREATE TABLE ACCOUNTS(
    ACCOUNTID NUMBER NOT NULL,
    MONEYAMOUNT BINARY_DOUBLE,
    USERID NUMBER NOT NULL,
	CONSTRAINT PK_ACOUNTID PRIMARY KEY (ACCOUNTID)
);

CREATE TABLE TRANSACTIONS(
    TRANSID NUMBER NOT NULL,
    AMOUNTDEP  BINARY_DOUBLE,
    AMOUNTWIT  BINARY_DOUBLE,
    USERID NUMBER NOT NULL,
    CONSTRAINT PK_TRANSID PRIMARY KEY (TRANSID)
);


/*Creating foreign keys*/
ALTER TABLE BANKUSER
ADD CONSTRAINT FK_ACCOUNTID
FOREIGN KEY (ACCOUNTID) REFERENCES ACCOUNTS(ACCOUNTID);

ALTER TABLE BANKUSER
ADD CONSTRAINT FK_TRANSID
FOREIGN KEY (TRANSID) REFERENCES TRANSACTIONS(TRANSID);

ALTER TABLE ACCOUNTS 
ADD CONSTRAINT FK_USERACCOUNTID
FOREIGN KEY (USERID) REFERENCES BANKUSER(USERID);

ALTER TABLE TRANSACTIONS
ADD CONSTRAINT FK_USERTRANSID
FOREIGN KEY (USERID) REFERENCES BANKUSER(USERID);


ALTER TABLE ACCOUNTS 
DROP CONSTRAINT FK_USERACCOUNTID;

ALTER TABLE ACCOUNTS
DROP COLUMN USERID;

ALTER TABLE ACCOUNTS 
ADD  USERID NUMBER;

ALTER TABLE ACCOUNTS
ADD CONSTRAINT FK_USERACCOUNTID
FOREIGN KEY (USERID) REFERENCES BANKUSER(USERID);

ALTER TABLE BANKUSER 
DROP CONSTRAINT FK_ACCOUNTID;
ALTER TABLE BANKUSER 
DROP COLUMN ACCOUNTID;

ALTER TABLE BANKUSER
DROP CONSTRAINT FK_TRANSID;
ALTER TABLE BANKUSER
DROP COLUMN TRANSID;


CREATE OR REPLACE PROCEDURE WITHDRAW_BAL(
    W_AMOUNT IN NUMBER,
    U_ID IN NUMBER,
    AMOUNT_LEFT OUT NUMBER
)
IS 
BEGIN 
    UPDATE ACCOUNTS SET MONEYAMOUNT = MONEYAMOUNT - W_AMOUNT
    WHERE USERID = U_ID;
    SELECT MONEYAMOUNT INTO AMOUNT_LEFT FROM ACCOUNTS WHERE USERID = U_ID;
END;

CREATE OR REPLACE PROCEDURE DEPOSIT_BAL(
    D_AMOUNT IN NUMBER,
    U_ID IN NUMBER,
    AMOUNT_LEFT OUT NUMBER
)
IS 
BEGIN 
    UPDATE ACCOUNTS SET MONEYAMOUNT = MONEYAMOUNT + D_AMOUNT
    WHERE USERID = U_ID;
    SELECT MONEYAMOUNT INTO AMOUNT_LEFT FROM ACCOUNTS WHERE USERID = U_ID;
END;